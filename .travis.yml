sudo: required
language: scala
jdk:
  - openjdk8
services:
  - docker

env:
  global:
    # AWS_ACCESS_KEY_ID
    - secure: "w72n8V0AzJ/V6noEYM9ronsvlZ3pOOFFaG3B9NJZcvWLMUMQfv7ewRiNQ7ADmIU2m2qVa0zbN0cdy4diWENOjSoSpZs68q5RjWelA6eZGsnhRVTBgv51IrbBXA2/hj+g9fwu5DhqL43sj07JotpqQYivAe6YsQggkQz6jwpki4q5+u5aV0lqNY4CoF+OnAW9aXho5rT0eUIjU98k4CmVahDcF9N8ZLxDx36ghnmOMqmwKPZ86Lq318t7qOP72ienSzs28J1toEAtuSfzFKy/JmtM9CJFV8wpH+gjxS1a+kPSUe9d6tH27WZh98ELsU197agr0z2Re6D8/ahU9zMgPM/IustGE/iHBWp4uW4bvtzUITi/TsegKWpAmX5+ifQuqhmDyBSKANHycvRq2WBNgkO5kcdpec6rvd28TzSCRVpx/b+fnx2+hAZ7OHrF8TpglTDvNExFKYam4KTGTzFNKtPn/QUegtwwZcaU0yG8Zmbc5hGTpjDaKsplE2tj+buuvJgz1ZdcZ1XZCVp18clEHC+I9+0zSuLNVqGLSO04Ds6MWyEC4601dHDif/ymEsYU6rherIB09FQ3DaVBmGccmTppCKHRMiHqHGvX57xuYkdLfL/2MpYE/MUjUAYmMujGVHzPlDoiZ4XiefV07d2e80rcZOj7PRordhhH5A1qJTU="
    # AWS_SECRET_ACCESS_KEY
    - secure: "i4yxiGfGHMWUBL6CBc5AFcXLWUOBbVtkuXIJU9JcUiucLULu157OedhuZ+4Yz0xhF1fxRgU0CzAQeNRGzerfrl6AyoLA4INoZCeba56P1SmgDfPxioXUPzRoUkjyPyfUEt6PH16HY0MCU9qa12Je3OAqQPFrDuXVpRnBBsnGorYx/K6IyFnXqEx95wMArQNKchPDNBbNDTz9Bnel7rVBqsn6PsLWZwxMXaUmm6v6UljXJ3P5kNnoBrAXSXyqMW0OwVZq6DAGhLhy3InBnP8/9cywjlWB1retM+Oz6ejrgLfmWtQFZUypsBNdXE5D+gx8quAMNce10tYDlpI/YvIVUeOUION+nUnkjtrzPaxW40LqpiSkpUqGyX3xaeO1g79rTObKr9P0MahbctPEUiMIFkKs5br0/sPqSLKFPXsAVqKQuzgupLXY+rQWg2cpczo8U+RqmFAy/k+EEr7NrpCY5vt9MKg9BzI7DosbQZkyvxvCQX05fboH+HkiOyzyxW6Z4WPqdcsVSI3+BYi7SkX4g1Hkr673byNgFsHgz5eiI619QlcwJlIhDReHXjJw1LrT9E0w/Rb8Jhq1asvbP1mnvbgWGQMV4CEbeSoI9NQ5774oYHH0dx/j4J3LqrGoGoN48yGO7RliZNPytz5Ou53MCQhTatWN+Ij5rNXs6BtW5cY="

install:
- git clone https://github.com/Opetushallitus/ci-tools.git
- source ci-tools/common/setup-tools.sh
- export ARTIFACT_NAME="virkailijan-tyopoyta"

script:
- mvn clean install -B -Dbranch=${TRAVIS_BRANCH} -Drevision=${TRAVIS_COMMIT} -DbuildNumber=${TRAVIS_BUILD_NUMBER}

- mv target/virkailijan-tyopoyta-*.jar $DOCKER_BUILD_DIR/artifact/${ARTIFACT_NAME}.jar
- cp -vr src/main/resources/* $DOCKER_BUILD_DIR/config/

- export BASE_IMAGE="baseimage-fatjar-openjdk8:master"
- ./ci-tools/common/pull-image.sh
- ./ci-tools/build/build-fatjar.sh $ARTIFACT_NAME

deploy:
  provider: script
  script: ./ci-tools/build/upload-image.sh $ARTIFACT_NAME
  on:
    all_branches: true