sudo: required
language: scala
jdk:
- openjdk8
services:
- docker

env:
  global:
  # AWS_ACCESS_KEY_ID
  - secure: "te+ws5eBUZMkh81dsTTT0KzMpQlbW4Mlh1ZFaHY41XYO/9yzGG1sQKLjrcQ3byt2s9qwErAL9u5mSXGnvNYWri2WuaI/915Qm/0iWnmLFZV4/FhJL0obSaW2XFx62ILzvIfDmyJWBmdHx1cFLKy+d21S6nzlI4NuRaUR7uWCpgOorsxMAxXefr9/1QdJEAULgvfd3SgFgdrGObaWt2QZ9YyJDOnTEnvlmY8AuxiyEVwTnhkRWDvhpPvqnu41R4s9tqng0tXGw0Z82aVqxCvLqto53KMmvCQV+u5FlIX4tJRFTWM/MLeG5jBSSq/eoUGppL4SMQiBK4LHMBYRXsCb5nQld4Lkl4BnwuduKl2g2sW2asJTOoXzs/fadc22rn3k4RYHSXnmBg3DDeCvs3xgpZtSdb/vqN0AaJ3pPv1zZr3Om+mA9H+IoBq1sYlGQVPvd6HwB0ociljX5qmcyYr6LAoTq5nkSuMH4nSE9WJWEvfv0mY55Cq+VWaEOGMDEDKsFrUKgD2NWKAxX3KDu5S83GWaOVlbaGECqexVLwRyk92iGwJZeRqQuZWsrtliWAiQMTAFneIa6PoNkCbki2ruEGrno9xzmgxruZTKBVZKNoH/ap0JlFHw9a+CvGYaBhTgxjRcKkeMZWgoeObMImctDOpEfwUIOPrtL0QEoAmBVYU="
  # AWS_SECRET_ACCESS_KEY
  - secure: "HlU1rce1MBWIMby3++Z0qd5KTgEi5Aoj94RCLaCQGxnEbzjvJ9aIeR7uiIhSjmg+jf6qjq/a5rfumbsuaUTHi3SvtEkhnSTj6I+Wxq9ujre1Ed3tKH4jSrzVIMhIwwNUjEhUS7tQLktV9J2rFyumAZl0laIg3zBw4izIa5R+qpLyluyEH8PDwJd7ZaLwvJ8y7ALYFEfPDxOPPsGEfQdtO85DNW+Bitryf/H9SgF3ClkQoMhtl5HTmxcARJUDMdVHxjl1w5VoNjV8Z7aG6kSh0nb1R/pdQA/ZxVVOah0h19jE39UkS1VT4IdsBf+sFmMsiRyuAJ07fEcQORGwaFd5OxApLu85WzV124VK8y2WkBTFlzMNAYEQGaKPaVWBUlYClad1Aq7vUk+lR9VroKItlMXca2oX5frr5Iuk5TLnx2MuRN+3sTGR3+/GfyXSVPFVZPEAEgI9rOb4tAVCjBIlTNcypWEl8i2HpJmzxiSCFcZx0wWb8iRSiFPybSUlzcgzis2vTHTrEn26ccgf+LHd/RvRwlA0rvDTUGKW4jK1AB5PfiTo2Dh/H9K5yx/LHnpmZ5TZRnT4yyI7hLViQ3A8LHZD5ISJVROjnczet8300MYFG4gEepnmmy8KotMPbO6YvGcS250EudE8RR/aR40kr04y7savVA4+LuD8Jzr81qY="

install:
- git clone https://github.com/Opetushallitus/ci-tools.git
- source ci-tools/common/setup-tools.sh
- export ARTIFACT_NAME="virkailijan-tyopoyta"

script:
- mvn clean install -B -Dbranch=${TRAVIS_BRANCH} -Drevision=${TRAVIS_COMMIT} -DbuildNumber=${TRAVIS_BUILD_NUMBER}

- mv target/virkailijan-tyopoyta-*.jar $DOCKER_BUILD_DIR/artifact/${ARTIFACT_NAME}.jar
- cp -vr src/main/resources/* $DOCKER_BUILD_DIR/config/

- export BASE_IMAGE="baseimage-fatjar-openjdk8:master"
- ./ci-tools/common/pull-image.sh
- ./ci-tools/build/build-fatjar.sh $ARTIFACT_NAME

deploy:
  provider: script
  script: ./ci-tools/build/upload-image.sh $ARTIFACT_NAME
  on:
    all_branches: true